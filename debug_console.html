<!DOCTYPE html>
<html>

<head>
    <title>MotoDocs AI - Console Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }

        .loading {
            background: #fff3cd;
            color: #856404;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
        }

        #console {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }

        #flutter-container {
            width: 100%;
            height: 600px;
            border: 2px solid #ddd;
            border-radius: 4px;
            margin: 20px 0;
        }

        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        .button:hover {
            background: #0056b3;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>MotoDocs AI - Console Debug</h1>

        <div id="status" class="status loading">Initializing...</div>

        <div>
            <button class="button" onclick="clearConsole()">Clear Console</button>
            <button class="button" onclick="testFlutter()">Test Flutter</button>
            <button class="button" onclick="checkErrors()">Check Errors</button>
        </div>

        <div id="console"></div>

        <div id="flutter-container">
            <iframe id="flutter-frame" src="http://localhost:3011" width="100%" height="100%"
                style="border: none;"></iframe>
        </div>
    </div>

    <script>
        let consoleOutput = '';

        function logToConsole(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            consoleOutput += logEntry;

            const consoleDiv = document.getElementById('console');
            consoleDiv.textContent = consoleOutput;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;

            console.log(message);
        }

        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        function clearConsole() {
            consoleOutput = '';
            document.getElementById('console').textContent = '';
        }

        function testFlutter() {
            logToConsole('Testing Flutter availability...');
            if (window._flutter) {
                logToConsole('Flutter loader found!', 'success');
                if (window._flutter.loader) {
                    logToConsole('Flutter loader is available', 'success');
                } else {
                    logToConsole('Flutter loader not available', 'error');
                }
            } else {
                logToConsole('Flutter loader not found', 'error');
            }
        }

        function checkErrors() {
            logToConsole('Checking for JavaScript errors...');
            const iframe = document.getElementById('flutter-frame');
            try {
                iframe.contentWindow.console.log('Test message from parent');
                logToConsole('Iframe communication successful', 'success');
            } catch (e) {
                logToConsole(`Iframe communication failed: ${e.message}`, 'error');
            }
        }

        // Override console methods to capture all output
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function (...args) {
            originalLog.apply(console, args);
            logToConsole(args.join(' '), 'info');
        };

        console.error = function (...args) {
            originalError.apply(console, args);
            logToConsole(args.join(' '), 'error');
        };

        console.warn = function (...args) {
            originalWarn.apply(console, args);
            logToConsole(args.join(' '), 'warn');
        };

        // Capture global errors
        window.addEventListener('error', function (e) {
            logToConsole(`Global Error: ${e.message} at ${e.filename}:${e.lineno}`, 'error');
            updateStatus(`Error: ${e.message}`, 'error');
        });

        // Capture unhandled promise rejections
        window.addEventListener('unhandledrejection', function (e) {
            logToConsole(`Unhandled Promise Rejection: ${e.reason}`, 'error');
            updateStatus(`Promise Error: ${e.reason}`, 'error');
        });

        // Initialize
        window.addEventListener('load', function () {
            logToConsole('Debug page loaded');
            updateStatus('Debug page ready - loading MotoDocs AI...', 'info');

            // Check if iframe loads successfully
            const iframe = document.getElementById('flutter-frame');
            iframe.addEventListener('load', function () {
                logToConsole('MotoDocs AI iframe loaded', 'success');
                updateStatus('MotoDocs AI loaded successfully', 'success');
            });

            iframe.addEventListener('error', function () {
                logToConsole('MotoDocs AI iframe failed to load', 'error');
                updateStatus('MotoDocs AI failed to load', 'error');
            });
        });
    </script>
</body>

</html>
