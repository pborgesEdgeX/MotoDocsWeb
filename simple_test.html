<!DOCTYPE html>
<html>

<head>
    <title>Simple Flutter Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }

        .loading {
            background: #fff3cd;
            color: #856404;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        #flutter-target {
            width: 100%;
            height: 400px;
            border: 2px solid #ddd;
            border-radius: 4px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Simple Flutter Web Test</h1>

        <div id="status" class="status loading">Loading Flutter app...</div>

        <div id="flutter-target">
            <p>Flutter app will appear here...</p>
        </div>

        <div id="console"></div>
    </div>

    <script>
        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            console.log(message);
        }

        function logToConsole(message, type = 'info') {
            const consoleDiv = document.getElementById('console');
            const logDiv = document.createElement('div');
            logDiv.style.padding = '5px';
            logDiv.style.margin = '2px 0';
            logDiv.style.borderRadius = '3px';
            logDiv.style.fontSize = '12px';

            if (type === 'error') {
                logDiv.style.background = '#ffebee';
                logDiv.style.color = '#c62828';
            } else if (type === 'success') {
                logDiv.style.background = '#e8f5e8';
                logDiv.style.color = '#2e7d32';
            } else {
                logDiv.style.background = '#f0f0f0';
                logDiv.style.color = '#333';
            }

            logDiv.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            consoleDiv.appendChild(logDiv);
        }

        // Log all errors
        window.addEventListener('error', function (e) {
            updateStatus(`Error: ${e.message}`, 'error');
            logToConsole(`JavaScript Error: ${e.message} at ${e.filename}:${e.lineno}`, 'error');
        });

        // Check if Flutter is available
        function checkFlutter() {
            logToConsole('Checking for Flutter loader...');

            if (window._flutter && window._flutter.loader) {
                logToConsole('Flutter loader found!', 'success');
                loadFlutterApp();
            } else {
                logToConsole('Flutter loader not found, retrying...');
                setTimeout(checkFlutter, 1000);
            }
        }

        function loadFlutterApp() {
            updateStatus('Loading Flutter app...', 'loading');
            logToConsole('Starting Flutter app load...');

            try {
                _flutter.loader.load({
                    serviceWorker: {
                        serviceWorkerVersion: null,
                    },
                    onEntrypointLoaded: function (engineInitializer) {
                        logToConsole('Entrypoint loaded successfully!', 'success');
                        updateStatus('Initializing Flutter engine...', 'loading');

                        engineInitializer.initializeEngine().then(function (appRunner) {
                            logToConsole('Engine initialized, running app!', 'success');
                            updateStatus('Flutter app is running!', 'success');
                            appRunner.runApp();
                        }).catch(function (error) {
                            updateStatus(`Engine init failed: ${error}`, 'error');
                            logToConsole(`Engine initialization error: ${error}`, 'error');
                        });
                    }
                }).catch(function (error) {
                    updateStatus(`Load failed: ${error}`, 'error');
                    logToConsole(`Flutter load error: ${error}`, 'error');
                });
            } catch (error) {
                updateStatus(`Exception: ${error}`, 'error');
                logToConsole(`Exception during load: ${error}`, 'error');
            }
        }

        // Start checking when page loads
        window.addEventListener('load', function () {
            logToConsole('Page loaded, starting Flutter check...');
            setTimeout(checkFlutter, 500);
        });
    </script>

    <!-- Load Flutter -->
    <script src="http://localhost:3011/flutter.js" defer></script>
</body>

</html>
